<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<title>Cadastro de Produtos</title>
</head>

<body>
	<div class="container">
		<div class="calcular">
			<button><a href="calcular.html">Calcular</a></button>
		</div>
		<h1>Cadastro de Produto</h1>

		<form id="form-produto">
			<input type="text" id="nome" name="nome" placeholder="Nome do Produto"><br>
			<button type="submit" id="sub">Cadastrar</button>
		</form>

		<h1>Produtos Cadastrados</h1>


		<ul id="lista-produtos">
		</ul>
	</div>

	<script>
		const form = document.querySelector('#form-produto');
		const url = 'http://localhost:3000/enviar-formulario';

		window.addEventListener('load', () => {
			atualizaLista();
		})

		form.addEventListener('submit', function (event) {
			event.preventDefault();
			enviaForm(form, url);

		});

		document.querySelector("#att").addEventListener('click', () => {
			//atualizaLista();
		})

		function percorreForm(form) {
			const data = {};
			for (const input of form.elements) {
				if (input.name) { // verifica se o elemento tem um nome
					data[input.name] = input.value;
				}
			}
			return data;
		}

		function enviaForm(form, url) {
			// Cria um objeto para armazenar os dados do formulÃ¡rio
			const data = percorreForm(form);

			const xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 201) {

					console.log(this.responseText);
					atualizaLista()
				}
			};
			xhttp.open('POST', url, true);
			xhttp.setRequestHeader('Content-type', 'application/json');
			xhttp.send(JSON.stringify(data));
		}

		async function atualizaLista() {
			try {
				const response = await fetch('http://localhost:3000/produtos');
				const produtos = await response.json();
				const ul = document.querySelector('#lista-produtos');
				ul.innerHTML = '';
				produtos.forEach(produto => {
					const li = document.createElement('li');
					li.textContent = produto.nome;
					li.classList.add('item-cadastrado');
					ul.appendChild(li);
				});
			} catch (error) {
				console.error(error);
			}
		}

	</script>
</body>

</html>